package templates

import "github.com/brayanMuniz/mondainai/internal/llm"

templ GameUI(sessionId string, messages llm.MessageHistory) {
	@Base("bg-slate-900") {
		<template id="user-message-template">
			<div class="flex justify-end my-2">
				<div class="bg-blue-500 text-white rounded-lg p-3 max-w-lg shadow">
					<p class="message-text"></p>
				</div>
			</div>
		</template>
		<div class="flex h-screen">
			<div class="w-[25%] bg-slate-800 p-6 flex flex-col space-y-6">
				<div id="emotion-pic" class="bg-slate-700/50 rounded-lg aspect-square flex items-center justify-center">
					<p class="text-slate-400">Emotion Pic</p>
				</div>
				<div id="timer" class="bg-slate-700/50 rounded-lg h-24 flex items-center justify-center">
					<p class="text-slate-400">Timer</p>
				</div>
				<div id="yen" class="bg-slate-700/50 rounded-lg h-16 flex items-center justify-center">
					<p class="text-slate-400">Yen</p>
				</div>
				<div class="flex-grow"></div>
			</div>
			<div class="w-[50%] flex flex-col p-4 bg-slate-100 text-black">
				@ChatInterface(sessionId, messages)
			</div>
			<div class="w-[25%] bg-slate-800 p-6">
				<div class="bg-slate-700/50 rounded-lg h-full flex items-center justify-center">
					<p class="text-slate-400">Game Helper</p>
				</div>
			</div>
		</div>
		<script>

	document.getElementById("chat-form").addEventListener("htmx:beforeRequest", function (evt) {
		const messageInput = evt.target.querySelector('input[name="message"]');
		const messageText = messageInput.value;
		if (!messageText.trim()) return;

		const template = document.getElementById("user-message-template");
		const clone = template.content.cloneNode(true);
		clone.querySelector(".message-text").textContent = messageText;

		const messagesContainer = document.getElementById("messages-container");
		messagesContainer.appendChild(clone);
		messagesContainer.scrollTop = messagesContainer.scrollHeight;
	});
</script>
	}
}
